# 仍未解决的问题



还是考虑一次只买一本书吧，时间不够。orz





## 1.购买书籍相关

购买书的具体流程还是比较不清晰

怎样实现如下事务：一个用户购买多种书，一种书可以购买多本(不超过卖方设定值)。

买书流程中，对书籍表的操作可以有两种：

1. 改变书籍的owner字段(从卖方改成买方)。缺点就是如果卖方有3本属性完全相同的书，这个方法就实现不了了。
2. 以买方名为owner并新建一条记录。比如：a从b买了两本《算法导论》(b有三本一样的《算法导论》在售)，那么在书籍表中，会以a为owner属性新建一条《算法导论》相关的字段，书本数设为2，然后从b的《算法导论》相关的书本数字段减去2。(如果a买了3本，b中的该书籍数会减为0，此时可以删除该字段)。   缺点是，如果a买了2本《算法导论》，一本改成了在售状态，另一本不修改，那这两本书

# 2.订单的保存

假如子订单的书本id完全依赖于书籍表，如果这本书一删除，子订单要么因为约束无法删除（这会导致卖方无法删除书的目的），要么和这本书的记录级联删除（这回导致主订单完整性缺失，因为主订单中的详细书目分散在许多子订单中）

想法：可以考虑<u>允许一些数据冗余。主订单增加一项详细书目字段(BLOB类型)</u>，这样在查询订单时就可以不考虑子订单缺失导致主订单不完整的问题。

这个详细书目字段可以如下编排：

书本1      x1本      a1元；
书本2      x2本      a2元；
书本3      x3本      a3元；
书本4      x4本      a4元；
书本5      x5本      a5元；
书本6      x6本      a6元；
书本7      x7本      a7元；

上面是买方的订单。相对应的，卖方订单也要同时生成。

不过尚未考虑一个买方一次从多个卖方购买书籍的情况

